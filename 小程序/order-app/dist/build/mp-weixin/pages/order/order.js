"use strict";var e=require("../../common/vendor.js"),o=require("../../api/order.js"),a=require("../../api/user.js");if(require("../../common/http.js"),require("../../store/user.js"),!Array){(e.resolveComponent("u-tabs-swiper")+e.resolveComponent("u-icon")+e.resolveComponent("u-loadmore")+e.resolveComponent("u-modal"))()}Math||((()=>"../../uni_modules/vk-uview-ui/components/u-tabs-swiper/u-tabs-swiper.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-loadmore/u-loadmore.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-modal/u-modal.js"))();const l={__name:"order",setup(l){const u=e.ref(!1),s=e.ref(""),r=e.ref(""),t=e.ref(null),n=e.ref([[],[],[],[]]),i=e.ref([{name:"全部"},{name:"待发货"},{name:"已发货"},{name:"已收货"}]),c=e.ref(0),d=e.ref(0);e.ref(0),e.ref(0);const v=e.ref(1),m=e.ref(3),p=e.ref(0),g=e.ref(["loadmore","loadmore","loadmore","loadmore"]),f=()=>{2!=c.value&&(g.value.splice(c.value,1,"loading"),setTimeout((()=>{v.value<p.value?(v.value=++v.value,j(c.value)):g.value.splice(c.value,1,"nomore")}),1e3))},b=e=>{g.value.splice(e,1,"loading"),d.value=e,v.value=1,p.value=0,n.value[c.value]=[]},w=({detail:{dx:e}})=>{t.value.setDx(e)},h=({detail:{current:e}})=>{console.log(e),console.log(c.value),t.value.setFinishCurrent(e),d.value=e,c.value=e,v.value=1,p.value=0,n.value[c.value]=[],j(e)},j=async a=>{let l=await o.getOrderListApi({openid:e.index.getStorageSync("openid"),type:0==a?"":a-1,currentPage:v.value,pageSize:m.value});if(l&&200==l.code){if(console.log(l),0==l.data.records.length)return void g.value.splice(c.value,1,"nomore");p.value=l.data.pages,l.data.records.map((e=>{n.value[a].push(e)})),l.data.total==p.value?g.value.splice(c.value,1,"nomore"):g.value.splice(c.value,1,"loadmore")}else g.value.splice(c.value,1,"nomore")},x=async()=>{if(console.log("确定"),!r.value)return void e.index.showToast({icon:"none",title:"请填写评论"});let o=await a.addCommentApi({orderId:s.value,openid:e.index.getStorageSync("openid"),commentText:r.value});o&&200==o.code&&(u.value=!1)},y=()=>{console.log("取消"),u.value=!1};return e.onReady((()=>{j(0)})),(a,l)=>({a:e.sr(t,"742b2b44-0",{k:"tabs"}),b:e.o(b),c:e.p({activeColor:"#f29100",list:i.value,current:c.value,"is-scroll":!1,swiperWidth:"750"}),d:e.f(i.value,((a,l,r)=>({a:e.f(n.value[l],((a,l,t)=>e.e({a:"742b2b44-1-"+r+"-"+t,b:e.t(a.userName),c:"742b2b44-2-"+r+"-"+t,d:e.t(a.phone),e:e.t(a.address),f:e.f(a.goodsList,((o,a,l)=>({a:o.goodsImage.split(",")[0],b:e.t(o.goodsName),c:e.t(o.specsName),d:e.t(o.goodsUnit),e:e.t(o.price),f:e.t(o.num),g:a}))),g:e.t(a.goodsList.length),h:e.t(a.price),i:"0"==a.status},"0"==a.status?{j:e.o((l=>((a,l)=>{e.index.showModal({title:"提示",content:"确定取消订单吗？",success:async function(e){if(e.confirm){console.log("用户点击确定"),console.log(a);let e=await o.cancelOrderApi({orderId:a.orderId});e&&200==e.code&&(b(d.value),j(d.value))}else e.cancel&&console.log("用户点击取消")}})})(a)))}:{},{k:"1"==a.status},"1"==a.status?{l:e.o((u=>((a,l)=>{console.log(l),e.index.showModal({title:"提示",content:"确定收货吗？",success:async function(e){if(e.confirm){console.log("用户点击确定收货"),console.log(a);let e=await o.confirmOrderApi({orderId:a.orderId});e&&200==e.code&&(b(d.value),j(d.value))}else e.cancel&&console.log("用户点击取消")}})})(a,l)))}:{},{m:"2"==a.status},"2"==a.status?{n:e.o((e=>(e=>{s.value=e.orderId,u.value=!0})(a)))}:{},{o:a.id}))),b:"742b2b44-3-"+r,c:e.p({status:g.value[l],bgColor:"#f2f2f2"}),d:l}))),e:e.p({name:"home",size:30,color:"rgb(94,94,94)"}),f:e.p({name:"arrow-right",color:"rgb(203,203,203)",size:26}),g:e.o(f),h:d.value,i:e.o(w),j:e.o(h),k:r.value,l:e.o((e=>r.value=e.detail.value)),m:e.o(x),n:e.o(y),o:e.o((e=>u.value=e)),p:e.p({"confirm-color":"#F3AF28","content-style":{padding:"10px"},"show-cancel-button":!0,title:"评论",zoom:!1,modelValue:u.value})})}};var u=e._export_sfc(l,[["__scopeId","data-v-742b2b44"]]);wx.createPage(u);
