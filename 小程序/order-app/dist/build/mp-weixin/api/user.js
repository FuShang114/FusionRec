"use strict";var e=require("../common/vendor.js"),t=require("../common/http.js"),a=require("../store/user.js");exports.addAddressApi=e=>t.http.post("/wxapi/address",e),exports.addCommentApi=e=>t.http.post("/wxapi/comment/addComment",e),exports.addressListApi=e=>t.http.get("/wxapi/address/list",e),exports.deleteCollectApi=e=>t.http.post("/wxapi/collect/deleteCollect",e),exports.editAddressApi=e=>t.http.put("/wxapi/address",e),exports.getAddressApi=e=>t.http.get("/wxapi/address/getAddress",e),exports.listCollectApi=e=>t.http.get("/wxapi/collect/list",e),exports.saveOrUpdateApi=e=>t.http.post("/wxapi/wxUser/saveOrUpdate",e),exports.uploadImageApi=e=>t.http.upload(e),exports.userLogin=async()=>{const s=a.userStore();let o=await new Promise(((t,a)=>{e.index.login({provider:"weixin",success:function(e){console.log("8888888888"),console.log(e.code),e&&e.code?t(e.code):a(e)}})})).catch((t=>{e.index.showToast({icon:"none",title:t.errMsg||"获取code失败!"})}));const{data:r}=await(d=o,t.http.post("/wxapi/user/wxLogin",{code:d}));var d;console.log("登录"),console.log(r),r&&(e.index.setStorageSync("openid",r.openid),e.index.setStorageSync("sessionkey",r.sessionKey));let i=await(p={openid:r.openid},t.http.get("/wxapi/wxUser/getUserInfo",p));var p;console.log(i.data),i.data&&i.data.avatarUrl&&(s.avatarUrl=i.data.avatarUrl,e.index.setStorageSync("avatarUrl",i.data.avatarUrl)),i.data&&i.data.nickName&&(s.nickName=i.data.nickName,e.index.setStorageSync("nickName",i.data.nickName))};
